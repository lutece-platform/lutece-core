import LuteceSearchList from"../../../../shared/modules/luteceSearchList.js";export class MenuManager{constructor(){this.toggleBtn=document.getElementById("toggle-theme"),this.body=document.querySelector("body"),this.savedTheme=localStorage.getItem("lutece-corporate-theme"),this.menu=document.getElementById("menu"),this.childMenu=document.getElementById("child-menu"),this.switcherMenu=document.getElementById("menu-switcher"),this.iconMenu=document.getElementById("menu-icon"),this.init()}init(){this.applySavedTheme(),this.setActive(),this.addMenuEventListeners(),this.setupSwitcherMenu(),this.addMenuHoverListeners(),this.addChildMenuHoverListeners(),this.searchMenu()}applySavedTheme(){this.savedTheme&&(this.body.setAttribute("data-bs-theme",this.savedTheme),"dark"===this.savedTheme&&(this.toggleBtn.checked=!0)),this.toggleBtn.addEventListener("change",(()=>{"light"===this.body.getAttribute("data-bs-theme")?(this.body.setAttribute("data-bs-theme","dark"),this.toggleBtn.checked=!0,localStorage.setItem("lutece-corporate-theme","dark")):(this.body.setAttribute("data-bs-theme","light"),this.toggleBtn.checked=!1,localStorage.setItem("lutece-corporate-theme","light"))}))}setActive(e){const t=document.querySelector("#feature-title a")&&document.querySelector("#feature-title a").getAttribute("href"),s=this.childMenu.querySelectorAll("#right-list .list-group-item"),i=this.childMenu.querySelectorAll("#feature-list .feature-group"),n=this.menu.querySelectorAll("a");if(this.childMenu.classList.remove("child-menu-found"),!e&&t&&(e=t.replace("#",""),s.forEach((s=>{if(s.href.includes(t))return s.classList.add("active","bg-body-tertiary"),void(e=s.getAttribute("feature-group"))}))),e)if(e.toLowerCase().includes(".jsp")){let t=e.split("/");if(t.length>=3){let e=t[2];n.forEach((t=>{t.getAttribute("href").includes(`/${e}/`)&&t.classList.add("active","bg-body-tertiary")}))}}else this.childMenu.classList.remove("d-none"),s.forEach((t=>{t.getAttribute("feature-group")!=e?t.classList.add("d-none"):(t.classList.remove("d-none"),this.childMenu.classList.add("child-menu-found"))})),i.forEach((t=>{t.getAttribute("feature-group")===e?(t.classList.remove("d-none"),this.childMenu.classList.add("child-menu-found")):t.classList.add("d-none")})),n.forEach((t=>{t.getAttribute("feature-group")===e?t.classList.add("active","bg-body-tertiary"):t.classList.remove("active","bg-body-tertiary")}));else n.forEach((e=>{e.getAttribute("href").includes(window.location.href)&&e.classList.add("active","bg-body-tertiary")}))}addMenuEventListeners(){this.menu.querySelectorAll("a:not(.feature-link)").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),this.setActive(e.getAttribute("feature-group"))}))}))}setupSwitcherMenu(){let e=localStorage.getItem("noPinState");null===e?(e=!1,localStorage.setItem("noPinState",!1)):(this.childMenu.classList.toggle("no-pin","true"===e),this.iconMenu.classList.toggle("ti-lock-open","true"===e),this.iconMenu.classList.toggle("ti-lock","false"===e)),this.switcherMenu.addEventListener("click",(()=>{this.childMenu.classList.toggle("no-pin"),this.iconMenu.classList.toggle("ti-lock-open"),this.iconMenu.classList.toggle("ti-lock"),localStorage.setItem("noPinState",this.childMenu.classList.contains("no-pin"))}))}addMenuHoverListeners(){this.menu.addEventListener("mouseover",(()=>{this.childMenu.matches(":hover")||this.childMenu.classList.add("child-menu-show")})),this.menu.addEventListener("mouseout",(e=>{this.childMenu.matches(":hover")||this.childMenu.classList.remove("child-menu-show")}))}addChildMenuHoverListeners(){this.childMenu.addEventListener("mouseover",(()=>{this.childMenu.classList.add("child-menu-show")})),this.childMenu.addEventListener("mouseout",(()=>{this.childMenu.classList.remove("child-menu-show")}))}searchMenu(){const e=document.querySelector("#search-menu"),t=document.querySelectorAll("#right-list a");new LuteceSearchList(e,t,{searchableChild:[".title",".text-muted"],highlight:!0,emptyMessageElement:document.querySelector("#empty-message"),hideClass:"d-none",extraSearchFunction:()=>{const s=document.querySelector("#feature-list");if(e.value.length>0)s.classList.add("d-none");else{s.classList.remove("d-none"),t.forEach((e=>{e.classList.add("d-none")}));const e=document.querySelector("#feature-list .feature-group:not(.d-none)").getAttribute("feature-group");e&&"home"!==e&&this.setActive(e)}}})}}