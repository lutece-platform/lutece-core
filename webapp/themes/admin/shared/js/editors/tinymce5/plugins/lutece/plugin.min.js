/**
 * LUTECE Plugin
 *
 * @author Lutece - Mairie de Paris
 */
(function () {
    var lutece = (function () {
        'use strict';
        tinymce.PluginManager.requireLangPack( 'lutece', 'fr_FR');
        tinymce.PluginManager.add( 'lutece', function( editor, url ) {
            /*
            Add a LUTECE icon
            */
            editor.ui.registry.addIcon( 'luteceicon', '<svg width="24" height="24"><use xlink:href="themes/admin/shared/js/editors/tinymce5/plugins/lutece/lutece.svg#logo"></use></svg>');
            editor.ui.registry.addIcon( 'luteceimageicon', '<svg width="24" height="24"><use xlink:href="themes/admin/shared/js/editors/tinymce5/plugins/lutece/lutece.svg#luteceimage"></use></svg>');
            editor.ui.registry.addIcon( 'lutecepdficon', '<svg width="24" height="24"><use xlink:href="themes/admin/shared/js/editors/tinymce5/plugins/lutece/lutece.svg#lutecepdf"></use></svg>');
            editor.ui.registry.addIcon( 'lutecepagelinkicon', '<svg width="24" height="24"><use xlink:href="themes/admin/shared/js/editors/tinymce5/plugins/lutece/lutece.svg#lutecepagelink"></use></svg>');
            
            let luteceConf = false;
            let luteceImageConf = false;
            let lutecePdfConf = false;
            let lutecePageLinkConf = false;
            let luteceNewsletterBlogConf = false;

            /*
            Conf for Lutece default linkService
            */
            const luteceDialogConf = {
                title: 'Lutece contents',
                url: 'jsp/admin/insert/GetAvailableInsertServices.jsp?input=tinymce5&selected_text=&mode=0',
                buttons: [
                    {
                        type: 'cancel',
                        name: 'cancel',
                        text: 'Close Dialog',
                        primary: false,
                        align: 'end'
                    }
                ],
            };
            /*
            Conf for library image linkService
            */
            const idImgSpace=editor.getParam( "lutece_insert_service_media_type_image_space" ) 
            const idImgType=editor.getParam( "lutece_insert_service_media_type_image" ) 
            const luteceImageDialogConf = {
                title: 'Images',
                url: `jsp/admin/plugins/library/SelectMedia.jsp?plugin_name=library&media_type=${idImgType}&browser_id_space=${idImgSpace}&browser_selected_space_id=${idImgSpace}&input=tinymce5&mode=0&selected_text=` ,
                buttons: [
                    {
                        type: 'cancel',
                        name: 'cancel',
                        text: 'Close Dialog',
                        primary: false,
                        align: 'end'
                    }
                ],
            };
            /*
            Conf for library pfd linkService
            */
            const idPdfSpace=editor.getParam( "lutece_insert_service_media_type_pdf_space" ) 
            const idPdfType=editor.getParam( "lutece_insert_service_media_type_pdf" ) 
            const lutecePdfDialogConf = {
                title: 'PDF',
                url: `jsp/admin/plugins/library/SelectMedia.jsp?plugin_name=library&media_type=${idPdfType}&browser_id_space=${idPdfSpace}&browser_selected_space_id=${idPdfSpace}&mode=0&input=tinymce5&selected_text=`,
                buttons: [
                    {
                        type: 'cancel',
                        name: 'cancel',
                        text: 'Close Dialog',
                        primary: false,
                        align: 'end'
                    }
                ],
            };
            /*
            Conf for pagelinkservice linkService
            */
            const lutecePageLinkDialogConf = {
                title: 'Page link',
                url: 'jsp/admin/insert/DisplayInsertService.jsp?insert_service_type=PAGE_INSERT_SERVICE&plugin_name=pagelinkservice&input=tinymce5&selected_text=',
                buttons: [
                    {
                        type: 'cancel',
                        name: 'cancel',
                        text: 'Close Dialog',
                        primary: false,
                        align: 'end'
                    }
                ],
            };
            /*
            Conf for newsletter - blog linkService
            */
            const luteceNewsletterBlogDialogConf = {
                title: 'Blog',
                url: 'jsp/admin/insert/DisplayInsertService.jsp?insert_service_type=blog_selection_is&plugin_name=newsletter-blog&input=tinymce5&mode=0&selected_text=',
                buttons: [
                    {
                        type: 'cancel',
                        name: 'cancel',
                        text: 'Close Dialog',
                        primary: false,
                        align: 'end'
                    }
                ],
            };

            // Insert service default button
            editor.ui.registry.addButton( 'lutece', {
                tooltip: "Add Lutece contents",
                icon: "luteceicon",
                onAction: () => {
                    luteceConf = editor.windowManager.openUrl( luteceDialogConf )
                }
            });

            // Image button
            editor.ui.registry.addButton( 'luteceImage', {
                tooltip: "Add site image",
                icon: "luteceimageicon",
                onAction: () => {
                    luteceImageConf = editor.windowManager.openUrl( luteceImageDialogConf )
                }
            });
            // PDF button
            editor.ui.registry.addButton( 'lutecePdf', {
                tooltip: "Add site pdf",
                icon: "lutecepdficon",
                onAction: () => {
                    lutecePdfConf = editor.windowManager.openUrl( lutecePdfDialogConf )
                }
            });
            // PageLinkService button
            editor.ui.registry.addButton( 'lutecePageLink', {
                tooltip: "Add link to site page",
                icon: "lutecepagelinkicon",
                onAction: () => {
                    const selectedText = editor.selection.getContent({format : 'text'});
                    lutecePageLinkDialogConf.url += selectedText
                    lutecePageLinkConf = editor.windowManager.openUrl( lutecePageLinkDialogConf )
                }
            });
            // PageLinkService button
            editor.ui.registry.addButton( 'luteceNewsletterBlog', {
                tooltip: "Add link to blog post",
                icon: "lutecepagelinkicon",
                onAction: () => {
                    const selectedText = editor.selection.getContent({format : 'text'});
                    luteceNewsletterBlogDialogConf.url += selectedText
                    luteceNewsletterBlogConf = editor.windowManager.openUrl( luteceNewsletterBlogDialogConf )
                }
            });

        });
    }());
})();