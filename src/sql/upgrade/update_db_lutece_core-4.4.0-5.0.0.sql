-- LUTECE-1717
UPDATE core_stylesheet SET source = 0x3C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D2249534F2D383835392D31223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A0D0A3C78736C3A706172616D206E616D653D22736974652D70617468222073656C6563743D22736974652D7061746822202F3E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3D305D223E0D0A093C64697620636C6173733D227370616E2D31352070726570656E642D3120617070656E642D3120617070656E642D626F74746F6D223E0D0A09093C64697620636C6173733D22706F72746C6574202D6C75746563652D626F726465722D726164697573223E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A09093C2F6469763E0D0A093C2F6469763E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3D315D22203E0D0A3C756C20636C6173733D22736974652D6D61702D6C6576656C2D6F6E65223E0D0A093C6C693E0D0A09093C6120687265663D227B24736974652D706174687D3F706167655F69643D7B706167652D69647D22207461726765743D225F746F70223E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22706167652D6E616D6522202F3E0D0A09093C2F613E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D22706167652D6465736372697074696F6E22202F3E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D22706167652D696D61676522202F3E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A09202020203C78736C3A746578742064697361626C652D6F75747075742D6573636170696E673D22796573223E0D0A0909202020203C215B43444154415B3C64697620636C6173733D22636C656172223E26233136303B3C2F6469763E5D5D3E0D0A09202020203C2F78736C3A746578743E0D0A093C2F6C693E0D0A3C2F756C3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3D325D22203E0D0A3C756C20636C6173733D22736974652D6D61702D6C6576656C2D74776F223E0D0A093C6C693E0D0A09093C6120687265663D227B24736974652D706174687D3F706167655F69643D7B706167652D69647D22207461726765743D225F746F70223E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22706167652D6E616D6522202F3E0D0A09093C2F613E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D22706167652D6465736372697074696F6E22202F3E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A093C2F6C693E0D0A3C2F756C3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3E325D22203E0D0A3C756C20636C6173733D22736974652D6D61702D6C6576656C2D68696768657374223E0D0A093C6C693E0D0A09093C6120687265663D227B24736974652D706174687D3F706167655F69643D7B706167652D69647D22207461726765743D225F746F70223E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22706167652D6E616D6522202F3E0D0A09093C2F613E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D22706167652D6465736372697074696F6E22202F3E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A093C2F6C693E0D0A3C2F756C3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167652D6465736372697074696F6E223E0D0A093C6272202F3E3C78736C3A76616C75652D6F662073656C6563743D222E22202F3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D226368696C642D70616765732D6C6973745B706167652D6C6576656C3D305D223E0D0A093C78736C3A696620746573743D22636F756E742870616765293E3022203E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D227061676522202F3E0D0A202020203C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D226368696C642D70616765732D6C6973745B706167652D6C6576656C3D315D223E0D0A093C78736C3A696620746573743D22636F756E742870616765293E3022203E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D227061676522202F3E0D0A202020203C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D226368696C642D70616765732D6C6973745B706167652D6C6576656C3D325D223E0D0A093C78736C3A696620746573743D22636F756E742870616765293E3022203E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D227061676522202F3E0D0A202020203C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D226368696C642D70616765732D6C6973745B706167652D6C6576656C3E325D223E0D0A093C78736C3A696620746573743D22636F756E742870616765293E3022203E0D0A09093C78736C3A6170706C792D74656D706C617465732073656C6563743D227061676522202F3E0D0A202020203C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167652D696D616765223E0D0A093C64697620636C6173733D226C6576656C2D6F6E652D696D616765223E0D0A20202020093C64697620636C6173733D22706F6C61726F6964223E0D0A09093C696D672020626F726465723D2230222077696474683D22383022206865696768743D22383022207372633D22696D616765732F6C6F63616C2F646174612F70616765732F7B2E7D2220616C743D2222202F3E0D0A2020202020202020203C2F6469763E0D0A093C2F646976203E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A0D0A3C2F78736C3A7374796C6573686565743E0D0A WHERE id_stylesheet = 217;

-- LUTECE-1693
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_duration', '120');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.enable_password_encryption', 'false');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.encryption_algorithm', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.default_user_level', '0');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.default_user_notification', '1');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.default_user_language', 'fr');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.default_user_status', '0');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.email_pattern', /*E*/'^[\\w_.\\-!\\#\\$\\%\\&''\\*\\+\\/\\=\\?\\^\\\`\\}\\{\\|\\~]+@[\\w_.\\-]+\\.[\\w]+$');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.email_pattern_verify_by', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.force_change_password_reinit', 'false');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_minimum_length', '8');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_format_upper_lower_case', 'false');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_format_numero', 'false');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_format_special_characters', 'false');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_history_size', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.maximum_number_password_change', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.tsw_size_password_change', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.use_advanced_security_parameters', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.account_life_time', '12');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.time_before_alert_account', '30');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.nb_alert_account', '2');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.time_between_alerts_account', '10');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.access_failures_max', '3');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.access_failures_interval', '10');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.expired_alert_mail_sender', 'lutece@nowhere.com');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.expired_alert_mail_subject', 'Votre compte a expiré');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.first_alert_mail_sender', 'lutece@nowhere.com');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.first_alert_mail_subject', 'Votre compte va bientot expirer');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.other_alert_mail_sender', 'lutece@nowhere.com');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.other_alert_mail_subject', 'Votre compte va bientot expirer');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.account_reactivated_mail_sender', 'lutece@nowhere.com');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.account_reactivated_mail_subject', 'Votre compte a bien été réactivé');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.access_failures_captcha', '1');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.notify_user_password_expired', '');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_expired_mail_sender', 'lutece@nowhere.com');
INSERT INTO core_datastore VALUES ('core.advanced_parameters.password_expired_mail_subject', 'Votre mot de passe a expiré');
INSERT INTO core_datastore VALUES ('portal.site.site_property.logo_url', 'images/logo-header-icon.png');
INSERT INTO core_datastore VALUES ('portal.site.site_property.menu.position', 'top');

UPDATE core_datastore SET entity_value = CASE 
	WHEN (SELECT parameter_value from core_user_parameter WHERE entity_key LIKE concat('%', parameter_key)) IS NOT NULL 
	THEN (SELECT parameter_value from core_user_parameter WHERE entity_key LIKE concat('%', parameter_key)) 
	ELSE entity_value 
END;

DROP TABLE core_user_parameter;

ALTER TABLE core_admin_user ADD COLUMN workgroup_key varchar(50) DEFAULT 'all';

UPDATE core_stylesheet SET source = 0x3C3F786D6C2076657273696F6E3D22312E30223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A3C78736C3A706172616D206E616D653D22736974652D70617468222073656C6563743D22736974652D7061746822202F3E0D0A3C78736C3A7661726961626C65206E616D653D2263757272656E742D706167652D6964222073656C6563743D2263757272656E742D706167652D696422202F3E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3D305D223E200D0A093C6469762069643D22747265652220636C6173733D226A73747265652D64656661756C74223E0D0A09093C6120687265663D227B24736974652D706174687D3F706167655F69643D7B706167652D69647D22207469746C653D227B706167652D6465736372697074696F6E7D22203E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22706167652D6E616D6522202F3E0D0A0909093C78736C3A696620746573743D226E6F7428737472696E6728706167652D726F6C65293D276E6F6E652729223E200D0A090909093C7374726F6E673E3C78736C3A746578742064697361626C652D6F75747075742D6573636170696E673D22796573223E2D20236931386E7B706F7274616C2E736974652E61646D696E5F706167652E74616241646D696E4D6170526F6C6552657365727665647D3C2F78736C3A746578743E0D0A090909093C78736C3A76616C75652D6F662073656C6563743D22706167652D726F6C6522202F3E3C2F7374726F6E673E0D0A0909093C2F78736C3A69663E2020202020202020202020200D0A09093C2F613E0D0A09093C756C3E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A09093C2F756C3E0D0A093C2F6469763E0D0A3C2F78736C3A74656D706C6174653E0D0A202020200D0A3C78736C3A74656D706C617465206D617463683D22706167655B706167652D6C6576656C3E305D22203E0D0A093C78736C3A7661726961626C65206E616D653D22696E646578222073656C6563743D22706167652D696422202F3E0D0A093C78736C3A7661726961626C65206E616D653D226465736372697074696F6E222073656C6563743D22706167652D6465736372697074696F6E22202F3E0D0A090D0A093C6C692069643D226E6F64652D7B24696E6465787D223E0D0A09093C6120687265663D227B24736974652D706174687D3F706167655F69643D7B706167652D69647D22207469746C653D227B246465736372697074696F6E7D223E0D0A09093C78736C3A76616C75652D6F662073656C6563743D22706167652D6E616D6522202F3E0D0A0909093C78736C3A696620746573743D226E6F7428737472696E6728706167652D726F6C65293D276E6F6E652729223E0D0A090909093C7374726F6E673E0D0A0909090920203C78736C3A746578742064697361626C652D6F75747075742D6573636170696E673D22796573223E236931386E7B706F7274616C2E736974652E61646D696E5F706167652E74616241646D696E4D6170526F6C6552657365727665647D3C2F78736C3A746578743E3C78736C3A76616C75652D6F662073656C6563743D22706167652D726F6C6522202F3E0D0A090909093C2F7374726F6E673E0D0A0909093C2F78736C3A69663E0D0A09093C2F613E0D0A09093C78736C3A63686F6F73653E0D0A0909093C78736C3A7768656E20746573743D22636F756E74286368696C642D70616765732D6C6973742F2A293E30223E0D0A090909093C756C3E0D0A090909092020203C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A090909093C2F756C3E0D0A0909093C2F78736C3A7768656E3E0D0A09092020203C78736C3A6F74686572776973653E0D0A090909093C78736C3A6170706C792D74656D706C617465732073656C6563743D226368696C642D70616765732D6C69737422202F3E0D0A09092020203C2F78736C3A6F74686572776973653E0D0A09093C2F78736C3A63686F6F73653E0D0A093C2F6C693E0D0A3C2F78736C3A74656D706C6174653E0D0A202020200D0A3C78736C3A74656D706C617465206D617463683D226368696C642D70616765732D6C697374223E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D227061676522202F3E0D0A3C2F78736C3A74656D706C6174653E0D0A202020200D0A3C2F78736C3A7374796C6573686565743E0D0A WHERE id_stylesheet = 279;
