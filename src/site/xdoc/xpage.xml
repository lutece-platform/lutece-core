<?xml version="1.0" encoding="ISO-8859-1"?>
  <document>
    <title>
      Comment créer une XPageApp
    </title>
   <body>
    <section name="Comment créer des applications à base des pages spéciales">
      
    
    <h3>
      Qu'appelle-t-on Page spéciale?
    </h3>
    <p>
      Sur Lutèce, on peut distinguer deux types de page :
    </p>
    <ul>
      <li>des pages que l'on pourrait qualifier de "classiques" qui
      sont composées à partir de portlets, cela concerne la
      majorité des pages du site
      </li>

      <li>des pages dites spéciales qui ne respectent pas cette
      logique de présentation.
      </li>
    </ul><br />
    Les applications à base de pages spéciales permettent de
    réaliser des fonctions comme :
    <ul>
      <li>
        <b>le chat :</b> chat du site
      </li>

      <li>
        <b>la lettre d'information :</b> formulaire qui permet
        l'inscription à la lettre d'information.
      </li>
      <li>
        <b>le plan du site :</b> affiche l'arborescence des pages
        du site.
      </li>
      <li>
        <b>les liens utiles :</b> reprend dynamiquement le contenu
        de l'ensemble des rubriques de Lutèce de type "Liens
        utiles" (qui sont des rubriques dont la caractéristique est
        de contenir des liens vers des sites internet).
      </li>

      <li>
        <b>les contacts :</b> permet d'envoyer un message aux
        contacts du site déclarés dans l'administration
      </li>
    </ul>
    </section>
    <h3>
      Description technique
    </h3>
    <p>
      Une page spéciale se distingue dès l'url par le paramètre
      <b>page</b> et non <b>id_page</b> comme l'ensemble des pages
      du site.<br />

      Par exemple,
      http://myhost/lutece/jsp/site/Portal.jsp?page=plan pour
      obtenir le plan du site.<br />
      Ce paramètre spécifie le nom du plugin contenant la
      XPageApp.<br />
    </p>
    <p>
      <i>Note : Par convention, nous désignerons ce paramètre sous
      la forme : <b>&lt;xpage&gt;</b></i>.
    </p>

    <h4>
      Traitement en JAVA
    </h4>Lorsque le paramètre <b>&lt;page&gt;</b> est détecté dans
    la requête, la classe
    <b>fr.paris.lutece.portal.web.PortalJspBean</b> (point d'entrée
    de Lutèce) appelle la méthode :<br />
    <br />

    <table>
      <tbody>
        <tr>
          <td>
            <b>public String getPage( HttpServletRequest request ,
            int nMode )</b>
          </td>
        </tr>
      </tbody>

    </table><br />
    de la classe
    <b>fr.paris.lutece.portal.service.XPageAppService</b>.<br />
    <br />
    Ce service va rechercher le plugin dont le nom est spécifié
    dans le paramètre <b>page</b> de la requête et récupérer à
    partir de celui-ci l'instance de sa classe de XPageApp.<br />

    <br />
    Toutes les XPageApp doivent implémenter l'interface :
    <b>fr.paris.lutece.portal.web.xpages.XPageApplication</b>.<br />

    Elle définit donc la méthode :<br />
    <br />
    <table>
      <tbody>
        <tr>
          <td>
            <b>public String getContent( HttpServletRequest
            request, int nMode, Plugin plugin</b> <b>);</b>
          </td>
        </tr>
      </tbody>
    </table>

    qui renvoie le contenu de la page en fonction des paramètres
    contenus dans la requête, du mode (normal ou administration) et
    de l'instance du plugin pour lequel elle est instancié (la même
    classe peut être instanciée dans des contextes
    différents).<br />
    <br />
    XPageService appelle cette méthode et remplit une structure
    XPage avec les données propres à la page spéciale :
    <ul>
      <li>titre (lu dans le fichier de configuration)
      </li>
      <li>contenu html de la page (décrit précédemment)
      </li>
      <li>le chemin de navigation : "Vous êtes ici" avec
      l'arborescence de la page.
      </li>

      <li>les mots clés associés à la page<br />
      </li>
    </ul>
    <h4>
      JSP
    </h4>Si la XPageApp développée a besoin d'une JSP de traitement
    supplémentaire (comme l'envoi d'un message dans la page contact
    par exemple), cette jsp doit être placée dans le répertoire
    commun aux autres jsp du site : portal/jsp/site. La seule règle
    imposée est l'inclusion en tête de fichier de la directive :
    <table border="1">
      <tbody>
        <tr>
          <td>
            <b>&lt;%@ page errorPage="ErrorPagePortal.jsp"
            %&gt;</b>
          </td>
        </tr>
      </tbody>
    </table>
    <h4>
      Accès à la page
    </h4>

    <p>
      Il n'y a pas de gestion automatique des liens vers les pages
      spéciales sur Lutèce.<br />
      Traditionnellement, les pages spéciales sont accessibles
      depuis le menu situé sous le bandeau.<br />
      L'ajout d'une page spéciale depuis le fichier de properties
      n'ajoute pas automatiquement la page spéciale dans ce menu.
      En effet, c'est un menu statique, les liens sont écrits en
      dur dans le template :
      <b>WEB-INF/templates/skin/site/page_menu_tools.html</b>.
    </p>
    <h3>
      Administration des pages
    </h3>Des fonctions d'administration sont généralement
    nécessaires afin de gérer les fonctionnalités de l'application
    en "backoffice".<br />

    Il suffit donc de créer pour le même plugin, les fonctions
    d'administration associées. [ <a href=
    "howto-create-admin-features.html">HOWTO - Créer des fonctions
    d'administration</a> ]<br />
    <br />
    <h3>
      Déclaration de la XPageApp dans le fichier de configuration
      d'un plugin
    </h3><br />

    <h3>
      Remarques
    </h3>
    <p>
      Les pages spéciales ne sont pas indexés par le moteur de
      recherche Lucene. Elles ne seront donc pas restituées lors
      d'une recherche depuis la page d'accueil
    </p>
  </body>
</document>
